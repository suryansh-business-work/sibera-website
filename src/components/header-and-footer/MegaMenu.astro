---
import { getAppsByCategory } from "../../data/apps-data";
import { getThemeByCategory } from "../../data/app-themes";

const appsByCategory = getAppsByCategory();
const categories = Object.keys(appsByCategory);
---

<div
  class="fixed inset-x-0 top-[88px] bg-white shadow-xl border-t border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 mega-menu"
  style="height: 600px;"
>
  <div class="flex h-full">
    <!-- Sidebar -->
    <div class="w-64 bg-gray-50 border-r border-gray-200 h-full overflow-y-auto py-4 flex-shrink-0">
      <ul class="space-y-1 px-2">
        {categories.map((category, index) => (
          <li>
            <button
              class={`w-full text-left px-4 py-3 rounded-md text-sm font-medium transition-colors duration-200 flex items-center justify-between group/btn ${index === 0 ? 'bg-white shadow-sm text-blue-700 ring-1 ring-gray-200' : 'text-gray-700 hover:bg-gray-100 hover:text-gray-900'}`}
              data-category={category}
              data-index={index}
            >
              <span>{category}</span>
              <i class={`fa-solid fa-chevron-right text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity ${index === 0 ? 'opacity-100 text-blue-700' : 'text-gray-400'}`}></i>
            </button>
          </li>
        ))}
      </ul>
    </div>

    <!-- Content Area -->
    <div class="flex-1 h-full overflow-y-auto bg-white p-8">
      {categories.map((category, index) => {
        const apps = appsByCategory[category];
        const theme = getThemeByCategory(category);
        return (
          <div 
            id={`category-content-${index}`}
            class={`category-content ${index === 0 ? 'block' : 'hidden'} animate-fade-in`}
          >
            <div class="mb-6 border-b border-gray-100 pb-4">
                <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                    {category}
                    <span class="ml-3 px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100">
                        {apps.length} Apps
                    </span>
                </h2>
                <p class="text-gray-500 mt-1 text-sm">Explore our suite of {category.toLowerCase()} applications.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {apps.map((app) => (
                <a
                  href={`/app/${app.appSlug || app.appName.toLowerCase().replace(/\s+/g, '-')}`}
                  class="group/card block p-4 rounded-lg border border-gray-100 hover:border-blue-500 hover:shadow-md transition-all duration-200 bg-white"
                >
                  <div class="flex items-start">
                    <div class="flex-shrink-0 mr-3">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm font-bold shadow-sm" style={`background-color: ${theme.primaryColor}`}>
                            {app.appName.substring(0, 2).toUpperCase()}
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-sm font-bold text-gray-900 group-hover/card:text-blue-600 truncate">
                            {app.appName}
                        </h3>
                        <p class="text-xs text-gray-500 mt-1 line-clamp-2 leading-relaxed">
                            {app.appDescription}
                        </p>
                         <div class="mt-3 flex items-center gap-2">
                            <span class={`inline-block w-2 h-2 rounded-full ${app.launchState === 'mvp' ? 'bg-green-500' : 'bg-yellow-400'}`}></span>
                            <span class="text-[10px] font-medium text-gray-400 uppercase tracking-wide">
                                {app.launchState === 'mvp' ? 'Available' : 'Coming Soon'}
                            </span>
                        </div>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </div>
        );
      })}
    </div>
  </div>
</div>

<style>
  .animate-fade-in {
    animation: fadeIn 0.2s ease-out forwards;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Custom Scrollbar for Sidebar */
  .overflow-y-auto::-webkit-scrollbar {
    width: 5px;
  }
  .overflow-y-auto::-webkit-scrollbar-track {
    background: transparent;
  }
  .overflow-y-auto::-webkit-scrollbar-thumb {
    background-color: #e2e8f0;
    border-radius: 20px;
  }
  .overflow-y-auto:hover::-webkit-scrollbar-thumb {
    background-color: #cbd5e1;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('[data-category]');
    const contents = document.querySelectorAll('.category-content');

    buttons.forEach(button => {
      button.addEventListener('mouseenter', () => {
        // Reset all buttons
        buttons.forEach(btn => {
            btn.classList.remove('bg-white', 'shadow-sm', 'text-blue-700', 'ring-1', 'ring-gray-200');
            btn.classList.add('text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
            const icon = btn.querySelector('i');
            if(icon) {
                icon.classList.remove('opacity-100', 'text-blue-700');
                icon.classList.add('text-gray-400');
            }
        });

        // Activate current button
        button.classList.remove('text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
        button.classList.add('bg-white', 'shadow-sm', 'text-blue-700', 'ring-1', 'ring-gray-200');
        const activeIcon = button.querySelector('i');
        if(activeIcon) {
            activeIcon.classList.remove('text-gray-400');
            activeIcon.classList.add('opacity-100', 'text-blue-700');
        }

        // Show content
        const index = button.getAttribute('data-index');
        contents.forEach(content => {
          content.classList.add('hidden');
          content.classList.remove('block');
        });
        const activeContent = document.getElementById(`category-content-${index}`);
        if (activeContent) {
            activeContent.classList.remove('hidden');
            activeContent.classList.add('block');
        }
      });
    });
  });
</script>
